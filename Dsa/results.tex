\section{Results} \label{sec_res}
In this section, we show two Fourier analysis of MIP: one where the $S_n$ order is
varied and one where the aspect ratio is varied. We also compare different
methods to solve MIP: congugate gradient (CG), conjugate gradient
preconditioned with symmetric Gauss-Seidel (PCG-SGS), conjugate gradient
preconditioned with ML using uncoupled aggregation (PCG-MLU),
conjugate gradient preconditioned with ML using MIS aggregation (PCG-MLM),
and AGMG. The options used for ML can be found in the Appendix.
\subsection{Fourier Analysis}
Analysing Source Iteration accelerated with DSA is often performed using
Fourier analysis \cite{larsen_dsa,consistent_p1}. When a Fourier analysis is
performed, the error is decomposed into different modes and by inspecting the 
damping of the different error modes, the effectiveness of the DSA scheme can 
be studied. The largest damping factor is the spectral radius of the method. 
The smaller the spectral radius is, the faster the scheme converges. If the 
spectral radius is greater than one, the method is unstable. 
\subsubsection{$S_n$ order varied}
This Fourier analysis was carried on a square cell, using a
Gauss-Legendre-Chebyshev (GLC) quadrature. The medium is homogeneous, the scattering
ratio $c=0.9999$ and periodic boundary conditions are used. The $x-$axis is the mesh
size in mean free path and the $y-$axis is the spectral radius. There are four
curves corresponding to different $S_n$ order: $S_2$, $S_4$, $S_8$ and
$S_{16}$.
\begin{figure}[H]
\centering
\includegraphics[width=0.5\textwidth]{./Dsa/sn_order_9999}
\caption{Fourier analysis as a function of the mesh optical thickness,
homogeneous infinite medium case.}
\end{figure}
MIP is stable for every cell size. The spectral radius is always less than
0.5, except for $S_2$ where it peaks at about 0.7.
\subsubsection{Aspect ratio varied}
For this Fourier analysis, we use a $S_{16}$ GLC quadrature, a homogeneous
medium, $c=0.9999$ and periodic boundary conditions. The $x-$axis is the mesh
size in mean free path in the $x$ direction and the $y-$axis is the spectral
radius. There are five curves corresponding to five different aspect ratio:
$\frac{Y}{X}=\frac{1}{16}$, $\frac{Y}{X}=\frac{1}{4}$, $\frac{Y}{X}=1$,
$\frac{Y}{X}=4$ and $\frac{Y}{X}=16$. 
\begin{figure}[H]
\centering
\includegraphics[width=0.5\textwidth]{./Dsa/aspect_ratio_9999}
\caption{Fourier analysis as a function of the mesh optical thickness,
homogeneous infinite medium case for different aspect ratios.}
\end{figure}
MIP is stable for every aspect ratio and the maximum of the spectral radius
peaks at about 0.5

\subsection{Homogeneous medium}
Next, we compare different solvers for MIP on a homogeneous medium, 10cm $\times$
10cm, $\Sigma_t=1$cm$^{-1}$ and $\Sigma_s=0.99$cm$^{-1}$, with vacuum boundary 
conditions and a source of intensity 1cm$^{-3}$s$^{-1}$. We use a $S_8$
Gauss-Legendre-Chebyshev quadrature, a Source Iteration solver with relative
tolerance of $10^{-8}$ and a relative tolerance for MIP of $10^{-10}$.
\subsubsection{Quadrilateral cells}
In this example, the mesh is composed of 9990 quadrilateral cells that corresponds 
to 39960 degrees of freedom. The solution is:
\begin{figure}[H]
\centering
\includegraphics[width=0.6\textwidth]{./Dsa/homog_quad_crop}
\caption{Scalar flux on a mesh composed of quadrilateral cells.}
\end{figure}
In the next table, the different solvers are compared:
\begin{table}[H]
\begin{center}
\caption{Comparison of different preconditioners for quadrilateral cells.}
\begin{tabular}{|c|c|c|c|c|c|c|}
\hline
& No-DSA & CG & PCG-SGS &  PCG-MLU & PCG-MLM & AGMG\\
\hline
SI iter   & 268     & 27      & 27        & 27       & 27      & 27 \\
Prec (s)  & NA      & NA      & 0.0147641 & 0.320911 & 1.2398  & 0.082\\
MIP (s)   & NA      & 136.531 & 178.6     & 45.116   & 43.4983 & 6.98518\\
CG iter   & NA      & 35419   & 11414     & 729      & 702     & 674\\
Total (s) & 290.911 & 168.548 & 213.06    & 78.2107  & 77.2278 & 39.4574\\
\hline
\end{tabular}
\end{center}
\end{table}
In this Table, SI iter is the number iteration of Source Iteration
needed to solve the problem, Prec is the time in seconds needed to
initialize the preconditioner used by CG, MIP is the total time in
seconds spent solving DSA during the calculation, CG iter is the total number 
of CG iterations used to solve MIP, and Total is the time in
seconds needed to solve the problem.

Using MIP decreases significantly the number of SI iterations and the
calculation time as expected. Using PCG-SGS decreases by a 
factor three the number of CG iterations compared to CG but the time 
needed to solve MIP is greater. With ML, the number of CG iterations is 
reduced by a factor 50 and the MIP calculation time is divided by three 
compared to CG. AGMG is by far the most efficient solver, the number of 
CG iteration is slightly lower than PCG-ML but the MIP calculation is 20 
times faster than CG.

\subsubsection{Polygonal cells}
In this problem, the mesh is composed of 13654 triangles, 250 quadrilaterals,
1400 pentagons, 1306 hexagons, 228 heptagons, and 6 octagons, for a total of
16844 cells and 58442 degrees of freedoms. This example will allow us to test
MIP and the different preconditioners on a mesh composed of different types of
cell. The solution and the mesh are:
\begin{figure}[H]
\centering
\includegraphics[width=0.6\textwidth]{./Dsa/homog_poly_crop}
\caption{Scalar flux on a mesh composed of polygonal cells.}
\end{figure}
The different solvers are compared in the next Table:
\begin{table}[H]
\begin{center}
\caption{Comparison of different preconditioners for polygonal cells.}
\begin{tabular}{|c|c|c|c|c|c|c|}
\hline
& No-DSA & CG & PCG-SGS & PCG-MLU & PCG-MLM & AGMG\\
\hline
SI iter   & 268     & 27      & 27        & 27       & 27      & 27\\
Prec (s)  & NA      & NA      & 0.0201421 & 0.482845 & 2.09054 & 0.097\\
MIP (s)   & NA      & 210.128 & 303.423   & 78.0993  & 71.4493 & 11.0419\\
CG iter   & NA      & 36352   & 13370     & 840      & 784     & 674\\
Total (s) & 458.132 & 265.026 & 358.745   & 134.434  & 128.731 & 66.0207\\
\hline
\end{tabular}
\end{center}
\end{table}
We see that using different types of cells in the same mesh does not affect
the performance of MIP or of the preconditioners. 

\subsection{Heterogeneous medium}
In this example, we use a heterogeneous medium composed of 184 triangles, 3720
quadrilaterals and 2791 regular hexagons of side 0.05$cm$ for a total of 6695 
cells and 32178 degrees of freedom. The domain is 5.28275$cm$ by 4.6$cm$. 
Reflective boundary conditions are used. The quadrature is a $S_{16}$ 
Gauss-Legendre-Chebyshev quadrature. The SI solver has a relative tolerance of 
$10^{-8}$ and the relative tolerance for MIP is $10^{-10}$. The domain is 
composed of three zones:
\begin{figure}[H]
\centering
\includegraphics[width=0.4\textwidth]{./Dsa/source_crop}
\caption{Zones of the domain.}
\end{figure}
The properties of the different zones are:
\begin{description}
\item[Green zone:] $\Sigma_t =1.5$cm$^{-1}$, $\Sigma_s = 1.44$cm$^{-1}$, source$ =
1$cm$^{-3}$s$^{-1}$
\item[Red zone:] $\Sigma_t = 1$cm$^{-1}$, $\Sigma_s = 0.9$cm$^{-1}$, no source
\item[Blue zone:] $\Sigma_t = 1$cm$^{-1}$, $\Sigma_s = 0.3$cm$^{-1}$, no source
\end{description}
The scalar flux for this problem is:
\begin{figure}[H]
\centering
\includegraphics[width=0.6\textwidth]{./Dsa/heterog_hex_crop_2}
\caption{Scalar flux on a mesh composed of hexagonal cells.}
\end{figure}
The different solvers are compared in the next Table:
\begin{table}[H]
  \begin{center}
    \caption{Comparison of different preconditioners for a heterogeneous medium.}
    \begin{tabular}{|c|c|c|c|c|c|c|}
      \hline
      & No-DSA & CG & PCG-SGS & PCG-MLU & PCG-MLM & AGMG\\
      \hline
      SI iter   & 122      & 18      & 18       & 18       & 18      & 18 \\
      Prec (s)  & NA       & NA      & 0.016149 & 0.336215 & 1.36803 & 0.065 \\
      MIP (s)   & NA       & 60.2031 & 123.05   & 31.7048  & 30.8669 & 2.80108\\
      CG iter   & NA       & 12016   & 6764     & 423      & 391     & 248 \\
      Total (s) & 413.274  & 131.297 & 188.586  & 101.888  & 103.734 & 71.5392\\
      \hline
    \end{tabular}
    \caption{Comparison of preconditioners with heterogeneous medium.}
  \end{center}
\end{table}
We can see that the comments that were done for the homogeneous tests are
still valid. MIP is effective even with heterogeneous medium and AGMG is
still the fastest solver.

\subsection{Rectangular cells}
Like mentioned previously in this Chapter, AMG can have difficulties when the
aspect ratio of the cells is high. Moreover, when the aspect ratio is high,
MIP becomes ill conditioned. In this example, the aspect ratio $Y/x = 10$. We
also compared the effect of the size of the coarsest grid on the convergence.
In the next Table, we compare No-DSA, CD, AGMG defined previously with:
\begin{enumerate}
  \item[PCG-MLU-D:] preconditioned conjugate gradient preconditioned with ML
    using uncoupled with a coarsest grid of size less or equal of 128 (default
    value).
  \item[PCG-MLU-M:] preconditioned conjugate gradient preconditioned with ML
    using uncoupled with a coarsest grid of size less or equal of 400 (same 
    value than AGMG).
  \item[PCG-MLM-D:] preconditioned conjugate gradient preconditioned with ML
    using MIS with a coarsest grid of size less or equal of 128 (default
    value).
  \item[PCG-MLM-M:] preconditioned conjugate gradient preconditioned with ML
    using MIS with a coarsest grid of size less or equal of 400 (same 
    value than AGMG).
\end{enumerate}
There are 9000 cells and thus, 36 000 degrees of freedom. The domain is 
square $3cm \times 3cm$, 300 divisions along x-axis and 30 divisions along 
y-axis. Relative tolerance $10^{-8}$, $S_{8}$ GLC quadrature, vacuum 
boundaries, $PWLD$ finite elements, $\Sigma_t = 1 cm^{-1}$, 
$\Sigma_s = 0.999 cm^{-1}$.
\begin{landscape}
  \begin{center}
    \begin{table}[H]
      \caption{Comparison of preconditioners on rectangular mesh.}
      \begin{centering}
        \begin{tabular}{|c|c|c|c|c|c|c|c|c|}
          \hline
          & No-DSA & CG & PCG-SGS & PCG-MLU-D & PCG-MLU-M & PCG-MLM-D &
          PCG-MLM-M & AGMG \\
          \hline
          SI iter    & 62      & 26      & 26       & 26       & 26       & 
            26       & 26       &  26 \\
          Prec (s)   & NA      & NA      & 0.015177 & 0.300424 & 0.310577 &
            0.900931 & 0.847251 & 0.044 \\
          MIP (s)    & NA      & 115.936 & 249.85   & 157.941  & 153.097  & 
            154.04   & 147.658  & 6.22109\\
          CG iter    & NA      & 29623   & 16675    & 2674     & 2674     & 
            2619     & 2619     & 810 \\
          Total (s)  & 62.6123 & 146.177 & 249.15   & 188.184  & 182.458  & 
            185.008  & 177.297  & 33.1472\\
          \hline
        \end{tabular}
      \end{centering}
    \end{table}
  \end{center}
\end{landscape}
We can see that except AGMG, all the other preconditioned conjugate gradients
performed significantly worse than for the others test cases. AGMG does not
seem to be affected by the ill conditioning of MIP or the high aspect ratio.
The change of coarsest grid size does not have a significant effect on the
time needed to solve MIP.
\begin{figure}[H]
  \centering
  \includegraphics[width=4cm]{./Dsa/rectangle}
  \caption{Scalar flux on rectangular mesh.}
\end{figure}
